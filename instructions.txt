--------------------------------
SEALNET USER GUIDE
--------------------------------
This document is intended as a detailed guide to help with installation and running of
SealNet, a face recognition software for Harbor Seals. The instructions are intended to 
run the software on Amazon Web Services (AWS) EC2 cluster running Linux but they can be 
modified for use on other setups running Linux or other Unix-like systems.
To run a command, type it out on the terminal and hit enter.

--------------------------------
DATA
--------------------------------
SealNet is a face recognition software that is trained using photos. As of now, the software
expects files of png, jpg and jpeg formats. 
The directories must be structured as follows:

.
├── SealFaceRecognition
└── photos
    ├── cross_validation
    │   ├── seal_1
    │   │   ├── photo1.png
    │   │   └── photo2.png
    │   └── seal_2
    │       ├── photo1.jpg
    │       └── photo2.jpg
    └── training
        ├── seal_3
        │   ├── photo1.png
        │   └── photo2.png
        └── seal_4
            ├── photo1.jpg
            └── photo2.jpg

The photos directory will then be copied to AWS as shown in step 2 of 'SET UP SEALNET'

--------------------------------
CONNECT TO AWS
--------------------------------
The instructions assume you are running MacOs or some other Unix-like system. If you have
Windows installed, you may need to download and install OpenSSH
https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse.

1. Download your SSH_KEY to your Downloads folder
2. Start the aws instance (contact ITS for more instructions)
3. Download the ssh key to the Downloads folder
4. Open terminal application from the applications folder
5. Run 'cd ~/Downloads/' to change the directory
6. Run 'ssh -i SSH_KEY USERNAME@AWS_CLUSTER_NAME' replacing SSH_KEY, USERNAME and AWS_CLUSTER_NAME
  as appropriate. For example 'ssh -i jdoe_id_rsa jdoe@gpu-1.colgate.edu'
7. Type in yes when prompted and hit enter
8. To end the AWS session type in 'sudo poweroff' and hit enter.

--------------------------------
INSTALL THE VIRTUAL ENVIRONMENT
--------------------------------
These instructions assume the EC2 instance has been configured by Colgate ITS. You will need
git and latest python3 installed.

1. Run 'cd /data' to access the data directory
2. Run 'mkdir USERNAME_workspace' replacing USERNAME as appropriate to create your workspace. This
   will be the primary working directory.
3. Run 'cd USERNAME_workspace'
4. Run 'wget https://repo.anaconda.com/archive/Anaconda3-2020.02-Linux-x86_64.sh' to download the 
   Anaconda installer.
5.  a. Run 'bash Anaconda3-2020.02-Linux-x86_64.sh' to start the installation process.
    b. Hit enter for the first prompt
    c. Hit q to skip to the end of the license, type yes for the prompt and hit enter.
    d. Type in '/data/USERNAME_workspace/anaconda3' for the install location and hit enter
    e. Type yes for the next prompt and hit enter
    The installation is now complete
6.  a. Run 'conda create --name myenv python=3.7' to create an environment.
    b. Type y and hit enter at the prompt.

--------------------------------
SET UP SEALNET
--------------------------------
1. Run 'git clone https://github.com/dgathogo/SealFaceRecognition.git' to download SealNet
2.  a. Download or copy the photos for training SealNet to your Downloads folder
    b. In another terminal window, run 'cd ~/Downloads/' to change directory
    c. Run 'scp -i SSH_KEY -r photos/ USERNAME@AWS_CLUSTER_NAME:/data/USERNAME_workspace/photos' to
     copy the photos
3. In the other terminal window still logged into AWS, run 'cd SealFaceRecognition' to change 
   directory
4. Install dependencies found in requirements.txt. For each command, run the command and then type
   in y and hit enter to install required dependencies at the prompt.
    a. 'conda activate myenv'
    b. 'conda install tensorflow=1.13.1'
    c. 'conda install scikit-learn'
    d. 'conda install matplotlib'
    e. 'conda install Pillow'
    f. 'conda install scipy=1.1.0'

--------------------------------
RUNNING
--------------------------------
These instructions assume that the project has been set up as in previous instructions.

Revisit 'CONNECT TO AWS' instructions above to connect to AWS from terminal application. 

The rest of these steps assume you are connected to AWS. Type the commands in the terminal window
without the quotes and then hit enter to run them.

If you need to run SealNet using new data, make sure it is formatted properly as shown in 'DATA'
above. Open a new terminal window and then use step 2 in 'SET UP SEALNET' to copy the data to AWS.
Once the data is ready, go back to the previous terminal window still logged in to AWS.

1. Run 'cd /data/USERNAME_workspace/SealFaceRecognition' to change directory
2. Run 'conda activate myenv' to start the virtual environment 
3. Run 'python train.py -c config.py -d ../photos' to start training the network
4. The results are found in the directory log/ and a summary is also written in log/results.txt.
5. Run 'sudo poweroff to end the AWS session'
